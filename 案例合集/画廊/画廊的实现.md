#path_provider  #provider  #flutter_screenutil #shared_preferences #image_picker 
## 实现思路
用 `image_picker`来选择图片然后利用 `path_provider `来获取路径位置,然后用File下载到本地,并且用`shared_preferences`来保存本地路径的信息,具体的shared_preferences再用provider进行状态管理
## 搭建基本界面
因为初步搭建,所以用的方法打算是三个页面-收藏-画廊-搜索
对应的也就是
```
PageView(  
  scrollDirection: Axis.vertical,    
  children: [  
    Column(  //收藏页面
    ),  
    PageView( //画廊页面  
    ),  
    Column(  //搜索页面
    ),  
  ],  
),
```
## 状态管理的shared_preferences
### shared_preferences的部分
因为在没有数据之前,只能用暂时来搭页面,不如一步到底,从1到3,先来创建贯穿全文的状态管理
首先我们先来创建一个类用来存放
```
class GalleryManage extends ChangeNotifier {}
```
!不要去尝试这样哦
状态类通常不支持异步构造函数。请在构造函数中执行异步操作。
```
class GalleryManage extends ChangeNotifier {  
   final SharedPreferences preferences = await SharedPreferences.getInstance();  
}
```
应该这样去做
```
class GalleryManage extends ChangeNotifier {  
  SharedPreferences? _preferences;  
  GalleryManage() {  
    _loadSharePreferences();  
  }  
  Future<void> _loadSharePreferences() async {  
    _preferences = await SharedPreferences.getInstance();  
    notifyListeners(); //通知更新  
  }  
}
```
然后就是添加几个方法-加载图片list,存储,删除
```
class GalleryManage extends ChangeNotifier {
......
List<String> _imagePaths = [];  
  
List<String> get imagePaths => _imagePaths;
......

//添加图片  
Future<void> saveImagePath(String path) async {  
  _imagePaths.add(path);  
  await _preferences?.setStringList('image_paths_list', _imagePaths);  
  notifyListeners();  
}  
  
//删除图片-同理  
Future<void> removeImagePath(String path) async {  
  _imagePaths.remove(path);  
  await _preferences?.setStringList('image_paths_list', _imagePaths);  
  notifyListeners();  
}  
  //加载图片-同理 
Future<void> loadImagePaths() async {  
  _imagePaths =  
      _preferences?.getStringList('image_paths_list') ?? []; //如果没有就返回一个空的  
  notifyListeners();  
}
......
}
```
### 接下来就是选择图片了
用到的是 #image_picker 
在使用前,要显查看权限的获取
Android 权限
在 `android/app/src/main/AndroidManifest.xml` 中添加：
```
<uses-permission android:name="android.permission.CAMERA"/>
<uses-permission android:name="android.permission.READ_EXTERNAL_STORAGE"/>
<uses-permission android:name="android.permission.WRITE_EXTERNAL_STORAGE"/>
```
iOS 权限
在 `ios/Runner/Info.plist` 中添加：
```
<key>NSCameraUsageDescription</key>
<string>需要访问您的相机以拍摄图片</string>
<key>NSPhotoLibraryUsageDescription</key>
<string>需要访问您的相册以选择图片</string>
<key>NSMicrophoneUsageDescription</key>
<string>需要访问您的麦克风以录制视频</string>
```
还是在这个状态管理类里创建
```
class GalleryManage extends ChangeNotifier {  
  SharedPreferences? _preferences; //存储  
  final ImagePicker _picker = ImagePicker(); //选择图片
  .......
  }
```
然后添加方法,这里暂时只是选择图片,添加的步骤在后面会提到
```
//用相册来选择图片
  Future<void> pickImageFromGallery() async {
    final XFile? image = await _picker.pickImage(source: ImageSource.gallery);
    if (image != null) {
      // 使用 image.path 来获取图片的路径
      print('选择的图片路径: ${image.path}');
    }
  }

//用相机来选择图片
  Future<void> pickImageFromCamera() async {
    final XFile? image = await _picker.pickImage(source: ImageSource.camera);
    if (image != null) {
      // 使用 image.path 来获取图片的路径
      print('拍摄的图片路径: ${image.path}');
    }
  }
```

